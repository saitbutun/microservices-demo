applications:
  - name: microservices-demo
    namespace: default
    source:
      type: git
      repoURL: https://github.com/saitbutun/microservices-demo.git
      targetRevision: feature/karpenter-graviton-migration
      path: microservice-app

  - name: monitoring
    syncWave: "0"
    namespace: monitoring
    serverSideApply: "true"
    source:
      type: helm
      repoURL: https://prometheus-community.github.io/helm-charts
      chart: kube-prometheus-stack
      targetRevision: 57.0.2
      helmValues: |
        crds:
          enabled: true
        prometheusOperator:
          enabled: true
          crds:
            enabled: true
        grafana:
          enabled: true
          adminPassword: admin
          service:
            type: ClusterIP
        prometheus:
          enabled: true
          service:
            type: ClusterIP
          prometheusSpec:
            retention: 7d
            replicas: 1
            serviceMonitorSelectorNilUsesHelmValues: false
        alertmanager:
          enabled: true

  - name: karpenter-stack
    syncWave: "-1"
    namespace: argocd  # Bu "Application" kaynaÄŸÄ±nÄ±n yaÅŸayacaÄŸÄ± yer
    source:
      type: git
      repoURL: https://github.com/saitbutun/microservices-demo.git
      targetRevision: feature/karpenter-graviton-migration
      # ðŸ‘‡ DÄ°KKAT: Terraform'daki local_file kaynaÄŸÄ±nda "filename" olarak
      # nereyi gÃ¶sterdiysen o KLASÃ–RÃœ yazmalÄ±sÄ±n.
      # Ã–nceki konuÅŸmamÄ±zda "k8s/karpenter" demiÅŸtik:
      path: .github/terraform
    destination:
      server: https://kubernetes.default.svc
      # ðŸ‘‡ Generated YAML iÃ§indeki "Application" (Controller) argocd'ye,
      # "NodePool" cluster geneline, "Job" ise karpenter namespace'ine gidecek.
      # VarsayÄ±lan olarak argocd seÃ§ebilirsin.
      namespace: argocd
    syncPolicy:
      automated:
        prune: true
        selfHeal: true
 